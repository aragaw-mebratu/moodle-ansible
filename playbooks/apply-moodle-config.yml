# playbooks/apply-moodle-config.yml (updated)
---
- name: Apply Moodle ConfigMaps
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create moodle-php-fpm-config ConfigMap
      kubernetes.core.k8s:
        state: present
        definition: "{{ lookup('file', 'php-fpm-configmap.yml') | from_yaml }}"
        kubeconfig: "{{ kubeconfig }}"

    - name: Create config ConfigMap from template
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: ConfigMap
          metadata:
            name: config
            namespace: "{{ moodle.namespace }}"
          data:
            config.php: |
              {{ lookup('template', '../templates/config.php.j2') | indent(14) }}
        kubeconfig: "{{ kubeconfig }}"