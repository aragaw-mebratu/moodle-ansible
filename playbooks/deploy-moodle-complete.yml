---
- name: Complete Moodle Deployment with Working Configuration
  hosts: localhost
  connection: local
  gather_facts: false
  
  vars:
    moodle_namespace: "moodle"
    
  tasks:
    - name: Deploy Moodle with working configuration
      import_tasks: deploy-moodle-working-config.yml
      
    - name: Validate deployment
      import_tasks: validate-moodle-deployment.yml
      
    - name: Display final success message
      debug:
        msg: 
          - "ðŸŽ‰ MOODLE DEPLOYMENT COMPLETED SUCCESSFULLY! ðŸŽ‰"
          - ""
          - "Key fixes applied:"
          - "  âœ… Direct database connection (no pooler)"
          - "  âœ… Corrected Redis password"
          - "  âœ… Hardcoded database credentials"
          - "  âœ… Optimized performance settings"
          - ""
          - "Access your Moodle instance at:"
          - "  http://<NODE_IP>:31203/login/index.php"
          - ""
          - "Admin credentials:"
          - "  Username: admin"
          - "  Password: admin123"